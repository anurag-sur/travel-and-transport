<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>AR Transport Models</title>
<script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/3.3.2/aframe/build/aframe-ar.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
<style>
*{ box-sizing:border-box; }
body{
  margin:0;
  overflow:hidden;
  font-family:'Inter',sans-serif;
  background:#0b0b0c;
  color:white;
}
/* Remove all cart and food-specific styles, keep only rating and scene centered */
#ratingMenu{
  position:absolute;
  bottom:200px;
  left:50%;
  transform:translateX(-50%);
  padding:12px 18px;
  background:rgba(20,20,22,.95);
  backdrop-filter:blur(20px);
  border-radius:16px;
  border:1px solid rgba(255,255,255,.1);
  display:none;
  z-index:5;
  align-items:center;
  gap:6px;
  box-shadow:0 8px 32px rgba(0,0,0,.4);
}
#ratingMenu.show{
  display:flex;
}
.star{
  font-size:32px;
  cursor:pointer;
  color:rgba(255,255,255,.2);
  transition:all .2s;
  line-height:1;
}
.star.active{
  color:#FFD54F;
  text-shadow:0 0 12px rgba(255,213,79,.5);
}
.star:active{ transform:scale(1.3); }
/* Center the scene container */
a-scene {
  pointer-events: none;
  height: 100vh;
  width: 100vw;
  display: flex;
  align-items: center;
  justify-content: center;
}
#topBar,
#toast,
#loading,
#quickActions,
#controls,
#fab,
#ratingMenu {
  pointer-events: auto;
}
</style>
</head>
<body>

<!-- Top Bar (optional, can be minimal) -->
<div id="topBar" style="position:absolute; top:0; width:100%; padding:10px; background:rgba(0,0,0,0.6); z-index:5; display:flex; justify-content:center;">
  <div style="color:white; font-weight:700;">AR Transport Models</div>
</div>

<!-- Rating UI -->
<div id="ratingMenu">
  <span class="star" data-s="1">â˜…</span>
  <span class="star" data-s="2">â˜…</span>
  <span class="star" data-s="3">â˜…</span>
  <span class="star" data-s="4">â˜…</span>
  <span class="star" data-s="5">â˜…</span>
</div>

<!-- Loading indicator -->
<div id="loading">
  <div id="loadingText">Loading modelsâ€¦</div>
  <div id="loadingBar">
    <div id="loadingProgress"></div>
  </div>
</div>

<!-- A-Frame Scene -->
<a-scene embedded vr-mode-ui="enabled:false" arjs="sourceType:webcam; debugUIEnabled:false;">
  <a-entity light="type:ambient;intensity:0.8"></a-entity>
  <a-entity light="type:directional;intensity:0.4" position="1 2 1"></a-entity>
  <a-entity camera></a-entity>
  <!-- Centered holder for models -->
  <a-entity id="holder" position="0 0 -4"></a-entity>
</a-scene>

<script>
const models = [];
const holder = document.getElementById("holder");
const loading = document.getElementById("loading");
const loadingText = document.getElementById("loadingText");
const loadingProgress = document.getElementById("loadingProgress");
const ratingStars = document.querySelectorAll(".star");
let loadedCount = 0;
let currentModelIndex = 0;
let yaw=0,pitch=0,scale=1;
let autoRotate=true;
let rating=0;

const transports = [
  {model:"models/bike/scene.gltf",name:"Bike",category:"western"},
  {model:"models/bus/scene.gltf",name:"Bus",category:"western"},
  {model:"models/car/scene.gltf",name:"Car",category:"western"},
  {model:"models/cruise_ship/scene.gltf",name:"Cruise Ship",category:"healthy"},
  {model:"models/helicopter/scene.gltf",name:"Helicopter",category:"indian"},
  {model:"models/metro/scene.gltf",name:"Metro",category:"western"},
  {model:"models/plane/scene.gltf",name:"Plane",category:"indian"},
  {model:"models/submarine/scene.gltf",name:"Submarine",category:"healthy"}
];

function showToast(text){
  alert(text); // or implement custom toast
}

// Load all models
transports.forEach((item, index) => {
  const entity = document.createElement("a-entity");
  entity.setAttribute("gltf-model", item.model);
  entity.object3D.scale.set(0.4,0.4,0.4);
  entity.object3D.visible=false;
  holder.appendChild(entity);
  models.push(entity);
  entity.addEventListener("model-loaded", () => {
    loadedCount++;
    const progress = (loadedCount / transports.length) * 100;
    loadingProgress.style.width = progress + "%";
    loadingText.textContent = `Loading modelsâ€¦ ${loadedCount}/${transports.length}`;
    if(loadedCount===transports.length){
      setTimeout(()=> {
        loading.style.display='none';
        showModel(0);
        showToast("Welcome to AR Transport! ðŸ‘‹");
      },300);
    }
  });
});

// Show model at index
function showModel(i){
  models.forEach((m,idx)=> m.object3D.visible= (idx===i));
  scale=1;
  models[i].object3D.scale.set(scale,scale,scale);
  yaw=0; pitch=0;
  models[i].object3D.rotation.set(0,0,0);
  currentModelIndex=i;
}

// Handle rotation
document.getElementById("topBar").onclick=()=>{
  // Show rating menu
  document.getElementById("ratingMenu").classList.toggle("show");
};
ratingStars.forEach(s=>{
  s.onclick=()=>{
    rating=parseInt(s.dataset.s);
    updateStars();
    showToast(`Rated ${rating} â˜…`);
    document.getElementById("ratingMenu").classList.remove("show");
  };
});
function updateStars(){
  ratingStars.forEach(s=>{
    s.classList.toggle("active",parseInt(s.dataset.s)<=rating);
  });
}

// Auto rotate
AFRAME.registerComponent("spin",{
  tick:function(){
    if(autoRotate && models[currentModelIndex]){
      yaw+=0.002;
      models[currentModelIndex].object3D.rotation.y=yaw;
    }
  }
});
document.querySelector("a-scene").setAttribute("spin","");

// Optional: Add buttons or gestures to switch between models
// For simplicity, use keyboard arrows
document.addEventListener("keydown", e=>{
  if(e.key==="ArrowLeft"){
    let newIdx = (currentModelIndex -1 + models.length)%models.length;
    showModel(newIdx);
  } else if(e.key==="ArrowRight"){
    let newIdx = (currentModelIndex +1)%models.length;
    showModel(newIdx);
  }
});
</script>

</body>
</html>
